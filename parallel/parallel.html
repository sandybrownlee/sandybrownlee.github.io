<!doctype html>

<title>Solution Selector</title> 
<!-- http://syntagmatic.github.com/parallel-coordinates/ -->
<link rel="stylesheet" type="text/css" href="style.css">

<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js"></script>
<script src="d3.parcoords.js"></script>
<script src="divgrid.js"></script>

<h2>Interactive Decision Making, using "Parallel Coordinates"</h2>
<p style="width:100%;">The following visualisation allows for an interactive narrowing down of the choices, considering multiple criteria. The example is choices for aspects of a building design. Each line represents a specific design; hovering your mouse pointer over the corresponding row in the table at the bottom of the page will highlight the line in the design. Each vertical line is a goal or characteristic of the design. e.g., GlazingRatio is how much of the walls are taken up by windows; WallType is the type of concrete used to build the walls; EnergykWh is the annual energy consumption of the building for heating, lighting and cooling; CapitalCost is how much it will cost to build. Drag a line along one of the vertical bars to choose a set of designs in a given range.</p>
<p style="width:100%;">For example, given these designs, we know that there is a big jump in energy consumption: several designs are over 42000kWh, the rest are below 39000kWh. So, drag a line from 40000 to the bottom of the EnergykWh bar to choose only the lower-energy solutions. W might now decide to keep only the cheaper options, so drag a ling from the bottom of the CapitcalCost bar to around 385000. We can now see that these cheaper buildings all share the same WallType, but it's still possible to use any of three CeilingTypes to achieve this range of cost and energy efficiency. Perhaps CeilingType 0 is the most visually appealing, so drag a line around 0 on CeilingType. There are now only a few options left. We can keep going this way until only one design is left.</p>

<p style="width:100%;">This work was influenced by: Michael Guckert, Nils Gumpfer, Jennifer Hannig, Till Keller, Neil Urquhart (2021). A conceptual framework for establishing trust in real world intelligent systems. Cognitive Systems Research vol 68, pp 143-155. DOI:<a href="https://doi.org/10.1016/j.cogsys.2021.04.001">10.1016/j.cogsys.2021.04.001</a></p>

<div id="checkBoxes"> </div>
<div id="example" class="parcoords"></div>
<div id="grid"></div>




<script id="brushing">// quantitative colour scale


factors_to_include = {};

//////////////////////////////////////////////////////
///////////// Handling the checkboxes ////////////////
//////////////////////////////////////////////////////
  function flipInclude(x){
    if(to_include[x]){
      to_include[x] = false;
    }
    else{
      to_include[x] = true;
    }
    generateCoords(); // Refresh the coordinates
  }

  function generateCheckboxes(){    
    document.getElementById('checkBoxes').innerHTML = check_names;
    var checkOut = "";
    var newLineCounter = 0;
    for (var i = 0; i < check_names.length; i++) {   
      if(check_names[i] != 'name'){
        checkOut +=  check_names[i] + ": <input type=\"checkbox\" id=\""+check_names[i]+"\" onclick=\"flipInclude("+ "\'" + check_names[i]+ "\'"  +")\"checked>        ---- ";

        newLineCounter += 1;
        if(newLineCounter>3){
          newLineCounter = 0;
          checkOut += " <br>"
        }
      }
    }
    document.getElementById('checkBoxes').innerHTML = checkOut;
  }
//////////////////////////////////////////////////////
</script>


<script>
//////////////////////////////////////////////////////
////   Reading the input CSV and converting to a dictionary
//////////////////////////////////////////////////////
var check_names  = "";
function readCSV(){
    d3.csv("input_data.csv", function(data) {  
        var headerNamesS = d3.keys(data[0]);
        check_names = headerNamesS;
    });
}

var to_include  = {}
function headToDict(){
    for (var i = 0; i < check_names.length; i++) {
      if(check_names[i] != 'name'){
        to_include[check_names[i]] = true;
      }
    }
  factors_to_include = to_include;
}

//////////////////////////////////////////////////////
////   Generating the Parallel Coordinates
//////////////////////////////////////////////////////
function generateCoords(){
  document.getElementById('example').innerHTML = "";
  var green_to_blue = d3.scale.linear()
    .domain([9, 50])
    .range(["#7AC143", "#00B0DD"])
    .interpolate(d3.interpolateLab);

  var color = function(d) { return green_to_blue(d['Mental Activity']); };
  console.log("color");
  console.log(color);


  var parcoords = d3.parcoords()("#example")
    .color(color)
    .alpha(0.4);

  // load csv file and create the chart
  d3.csv('input_data.csv', function(data) {
    parcoords
      .data(data)
      .render()
      .brushMode("1D-axes");  // enable brushing

    // create data table, row hover highlighting
    var grid = d3.divgrid();
    d3.select("#grid")
      .datum(data.slice(0,48))
      .call(grid)
      .selectAll(".row")
      .on({
        "mouseover": function(d) { parcoords.highlight([d]); updateInfoOnHover(d["Solution"]) },
        "mouseout": parcoords.unhighlight
      });

    // update data table on brush event
    parcoords.on("brush", function(d) {
      d3.select("#grid")
        .datum(d.slice(0,48))
        .call(grid)
        .selectAll(".row")
        .on({
          "mouseover": function(d) { parcoords.highlight([d]);updateInfoOnHover(d["Solution"]) },
          "mouseout": parcoords.unhighlight
        });
    });
  });

}




var treatment_definitions = {};

function getTreatmentDescriptions()
{
  d3.csv("treatment_definitions.csv", function(data) {
      for (var i = 0; i < data.length; i++) {
        treatment_definitions[data[i].Solution] = data[i].Description;
      }
  });
}


function updateInfoOnHover(treatment_name)
{  
  document.getElementById('treatment_desc_div').innerHTML = "<h1>"+treatment_name+"</h1>     " + treatment_definitions[treatment_name];
}


//////////////////////////////////////////////////////
////   First Run
//////////////////////////////////////////////////////
function initialise(){
    return d3.csv("input_data.csv", function(data) {  
        var headerNamesS = d3.keys(data[0]);
        check_names = headerNamesS;
        getTreatmentDescriptions();
        headToDict();
        generateCheckboxes();
        generateCoords();
    });
}

initialise();


</script>



<div id = "treatment_desc_div">

</div>

